<div class="px-4 py-3 mt-2 mx-3 flex flex-col bg-white shadow-md rounded-lg">
  <div class=" absolute mt-0 ml-3 mr-4 text-[1.7em] font-semibold pointer-events-none">Employee</div>
  <div class="text-sm breadcrumbs absolute mt-5 ml-3">
    <ul>
      <li class="text-gray-500"><a routerLink="../home">Home</a></li>
      <li>Employee</li>
    </ul>
  </div>

  <form [formGroup]="employeeSearchForm" class="flex flex-row animate animate-fade">
  <div class="join ml-auto  scale-95">
      <input
        type="text"
        placeholder="FullName"
        class="input input-bordered w-15 max-w-xs focus:outline-none text-sm join-item"
        formControlName="ssfullname"
      />

      <input
        type="text"
        placeholder="Employee Number"
        class="input input-bordered w-15 max-w-xs bg-white border-gray-300 text-sm join-item"
        formControlName="ssnumber"
      />

    <select class="select select-bordered w-15 border-gray-300 text-sm bg-white h-5 join-item"
            formControlName="ssgender"
            data-tip="Gender"
    >
      <option disabled value="default">Gender</option>

      @for(gender of genders; track genders){
        <option value="{{gender.id}}">{{gender.name}}</option>
      }
    </select>

    <select class="select select-bordered w-15 border-gray-300 text-sm bg-white h-5 join-item"
            formControlName="ssdesignation"
            data-tip="Gender"
    >
      <option disabled value="default">Designation</option>

      @for(designation of designations; track designations){
        <option value="{{designation.id}}">{{designation.name}}</option>
      }
    </select>

    <button class="btn join-item border-black bg-gray-950 text-gray-300 hover:bg-gray-900" (click)="handleSearch()">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-5 h-5"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"
        />
      </svg>
    </button>
  </div>
    <button class="btn border-gray-300 bg-gray-950 text-gray-300 hover:bg-gray-900" (click)="clearSearch()">
      Clear
    </button>
  </form>
</div>

<mat-grid-list [cols]="12" rowHeight="4rem">

  <mat-grid-tile [colspan]="4" [rowspan]="10">
    <div class="w-full h-full bg-white mt-4 ml-2 rounded-md shadow-md border-2 border-[[#1e4263]] overflow-auto">

      <div class="w-full h-[2.5rem] bg-[#1e4263] flex items-center rounded-tl-md rounded-tr-md">
        <span class="ml-5 text-white text-lg ">Data Form</span>
      </div>

      <form class="mt-5" [formGroup]="employeeForm">

        <div class="h-28 mb-8 flex flex-row items-center justify-center">
          <img class="h-32 w-32 rounded-full border-2" src="{{imageempurl ? imageempurl : 'assets/tabledefault.png'}}">
          <div class="flex flex-col mt-2">
            <input  id="userImage" hidden="hidden" (change)="selectImage($event)" Select type="file" formControlName="photo">
            <label for="userImage" class="btn ml-10 mb-2 text-white rounded-md text-center bg-gray-950 text-white w-28 hover:bg-gray-900">Select</label>
            <label class="btn ml-10 mb-2 text-white rounded-md text-center bg-gray-950 text-white hover:bg-gray-900" (click)="clearImage()">Clear</label>
          </div>
        </div>

        <div class="relative w-full px-2 mb-3">
          <input
            type="text"
            placeholder="Full Name"
            class="peer input input-bordered w-full focus:outline-none"
            formControlName="fullname"
          />
          <label class="floating-label">Full Name</label>

        </div>

        <div class="relative w-full px-2 mb-3">
          <input
            type="text"
            placeholder="Calling Name"
            class=" peer input input-bordered w-full focus:outline-none"
            formControlName="callingname"
          />
          <label class="floating-label">Calling Name</label>

        </div>

        <div class="relative w-full px-2 mb-3">
          <input
            type="text"
            placeholder="NIC"
            class=" peer input input-bordered w-full focus:outline-none"
            formControlName="nic"
          />
          <label class="floating-label">NIC</label>
        </div>

        <div class="relative w-full px-2 mb-3">
          <input
            type="text"
            placeholder="Date Of Birth"
            class="peer input input-bordered w-full focus:outline-none"
            formControlName="dobirth"
            onfocus="(this.type='date')"
          />
          <label class="floating-label">Date Of Birth</label>
        </div>

        <div class="flex flex-row items-center mb-3">
        <div class="w-full relative px-2">
        <select class=" select select-bordered w-full focus:outline-none"
                formControlName="gender"
        >
          <option disabled [ngValue]="null">Gender</option>

          @for(gender of genders; track genders){
            <option [value]=gender.id>{{gender.name}}</option>
          }
        </select>
          <label class="floating-labels-select">Gender</label>
        </div>

          <div class="w-full relative px-2">
          <select class=" select select-bordered w-full focus:outline-none"
                  formControlName="employeestatus"
          >
            <option disabled [ngValue]="null">Status</option>

            @for(employeestatus of employeestatuses; track employeestatuses){
              <option value='{{employeestatus.id}}'>{{employeestatus.name}}</option>
            }
          </select>
            <label class="floating-labels-select">Status</label>
          </div>
        </div>

        <div class="relative w-full px-2 mb-3">
          <input
            type="text"
            placeholder="Address"
            class=" peer input input-bordered w-full focus:outline-none"
            formControlName="address"
          />
          <label class="floating-label">Address</label>
        </div>

        <div class="relative w-full px-2 mb-3">
          <input
            type="text"
            placeholder="Email"
            class=" peer input input-bordered w-full focus:outline-none"
            formControlName="email"
          />
          <label class="floating-label">Email</label>
        </div>

        <div class="flex flex-row items-center mb-3">
        <div class="w-full px-2 relative">
          <input
            type="text"
            placeholder="Mobile"
            class="peer input input-bordered w-full  focus:outline-none"
            formControlName="mobile"
          />
          <label class="floating-label">Mobile</label>
        </div>

          <div class="w-full px-2 relative">
            <input
              type="text"
              placeholder="Land"
              class="peer input input-bordered w-full focus:outline-none"
              formControlName="land"
            />
            <label class="floating-label">Land</label>
          </div>

        </div>

        <div class="flex flex-row items-center mb-3 px-2">
          <div class="relative mr-2 w-full">
            <input
              type="text"
              placeholder="Number"
              class="peer input input-bordered w-full focus:outline-none"
              formControlName="number"
            />
            <label class="floating-label">Number</label>
          </div>

          <button class="btn bg-gray-950 text-white hover:bg-gray-900" (click)="generateRandomNumber()">Generate Number</button>
        </div>

        <div class="flex flex-row items-center mb-3">
          <div class="relative w-full px-2">
          <select
            class="peer select select-bordered w-full focus:outline-none mr-2"
            formControlName="emptype"
          >
            <option disabled [ngValue]="null">EmpType</option>
            @for (emptype of emptypes; track emptypes) {
              <option value="{{emptype.id}}">{{emptype.name}}</option>
            }
          </select>
            <label class="floating-labels-select">EmpType</label>
          </div>

          <div class="relative w-full px-2">
          <select
            class="peer select select-bordered w-full focus:outline-none"
            formControlName="designation"
          >
            <option disabled [ngValue]="null">Designation</option>

            @for (designation of designations; track designations) {
              <option value="{{designation.id}}">{{designation.name}}</option>
            }
          </select>
            <label class="floating-labels-select">Designation</label>
          </div>

        </div>

        <div class="relative w-full mb-3 px-2">
            <textarea
              class="peer textarea textarea-bordered w-full h-36 focus:outline-none"
              placeholder="Description"
              formControlName="description"
            ></textarea>
          <label class="floating-label">Description</label>
        </div>


        <div class="flex flex-row mt-3 max-w-[99%] px-2 pb-5">
          <button class="btn text-white bg-gray-950 mr-1 w-1/4 hover:bg-gray-900" [disabled]="!enaadd || !hasWriteAuthority" (click)="addEmployee()">Add</button>
          <button class="btn text-white bg-gray-950 mr-1 w-1/4 hover:bg-gray-900" [disabled]="!enaupd || !hasUpdateAuthority" (click)="updateEmployee(employee)">Update</button>
          <button class="btn text-white bg-gray-950 w-1/4 hover:bg-gray-900" (click)="deleteEmployee(employee)"
                  [disabled]="!hasDeleteAuthority || !enadel" >Delete</button>
          <button class="btn text-white bg-gray-950 w-1/4 hover:bg-gray-900" (click)="clearForm()">Clear</button>
        </div>

      </form>


    </div>
  </mat-grid-tile>

  <mat-grid-tile [colspan]="8" [rowspan]="10">
    <div class="w-full h-full bg-white mt-4 ml-2 mr-2 rounded-md shadow-md overflow-auto">
      <div class="w-full h-[2.5rem] bg-[#1e4263] flex items-center rounded-tl-md rounded-tr-md">
        <span class="ml-5 text-white text-lg ">Data List</span>
      </div>
      <div class="overflow-visible p-4 mt-2 flex flex-col bg-white rounded-lg">
              @if(!isFailed || !isLoading || employees.length !== 0){
                <table class="text-left p-4 table" >
                  <thead>
                  <tr class="text-black bold">
                    <th>Profile</th>
                    <th>Designation</th>
                    <th>Personal Info</th>
                    <th>Address</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                  </thead>

                  <tbody>
                    @for(employee of data | async; track employees){
                      <tr>
                        <td>
                          <div class="flex items-center gap-3 text-left">
                            <div>
                              <div class="mask mask-circle w-12 h-12">
                                <img
                                  src="{{employee.photo ? 'data:image/jpeg;base64,'+ employee.photo :'assets/tabledefault.png'}}"  alt="profile"
                                />
                              </div>
                            </div>

                            <div>
                              <div class="font-bold">{{employee.fullname}}</div>
                              <div class="text-sm opacity-50">{{employee.number}}</div>
                            </div>
                          </div>
                        </td>

                        <td class="block items-center">
                          <span>{{employee.designation.name}}</span>
<!--                          <div class="block mt-2 badge pb-3 badge-neutral badge-sm w-32">Since 2015-02-04</div>-->
                        </td>

                        <td>
                      <span class="flex items-center">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke-width="1.5"
                          stroke="currentColor"
                          data-slot="icon"
                          class="w-4 h-4 mr-1.5 text-gray-500"
                        >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z"
                        />
                      </svg>
                        {{employee.nic}}
                      </span>

                          <span class="flex items-center mt-1">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none" viewBox="0 0 24 24"
                          stroke-width="1.5" stroke="currentColor"
                          data-slot="icon"
                          class="w-4 h-4 mr-1.5 text-gray-500"
                        >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M12 8.25v-1.5m0 1.5c-1.355 0-2.697.056-4.024.166C6.845 8.51 6 9.473 6 10.608v2.513m6-4.871c1.355 0 2.697.056 4.024.166C17.155 8.51 18 9.473 18 10.608v2.513M15 8.25v-1.5m-6 1.5v-1.5m12 9.75-1.5.75a3.354 3.354 0 0 1-3 0 3.354 3.354 0 0 0-3 0 3.354 3.354 0 0 1-3 0 3.354 3.354 0 0 0-3 0 3.354 3.354 0 0 1-3 0L3 16.5m15-3.379a48.474 48.474 0 0 0-6-.371c-2.032 0-4.034.126-6 .371m12 0c.39.049.777.102 1.163.16 1.07.16 1.837 1.094 1.837 2.175v5.169c0 .621-.504 1.125-1.125 1.125H4.125A1.125 1.125 0 0 1 3 20.625v-5.17c0-1.08.768-2.014 1.837-2.174A47.78 47.78 0 0 1 6 13.12M12.265 3.11a.375.375 0 1 1-.53 0L12 2.845l.265.265Zm-3 0a.375.375 0 1 1-.53 0L9 2.845l.265.265Zm6 0a.375.375 0 1 1-.53 0L15 2.845l.265.265Z"
                        />
                      </svg>

                            {{employee.dobirth}}
                      </span>
                        </td>

                        <td class="w-51">
                          <span>{{employee.address}}</span>
                        </td>

                        <td>
                          <div class="flex items-center">
                            <div class="badge badge-xs mr-1.5 {{employee.employeestatus.name === 'Available'? 'bg-success' : 'bg-error'}}"></div>
                            {{employee.employeestatus.name}}
                          </div>
                        </td>

                        <th>
                          <div class="join">
                            <button
                              class=" join-item {{hasReadAuthority ? '' : 'text-gray-300'}} hover:cursor-pointer"
                              (click) = "fillForm(employee)"
                              [disabled]="!hasReadAuthority"
                            >
                              <svg
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke-width="1.5"
                                stroke="currentColor"
                                data-slot="icon"
                                class="w-5 h-5 mr-3"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"
                                />
                              </svg>
                            </button>

                          </div>
                        </th>

                      </tr>
                    }
                  </tbody>
                </table>
                <mat-paginator [length]="20" [pageSize]="5" [pageSizeOptions]="[3,5,10,20]"></mat-paginator>
              }

              @if (isLoading){
                <app-page-loading/>
              }

              @if (isFailed){
                <app-page-error/>
              }
        </div>
            </div>
          </mat-grid-tile>


        </mat-grid-list>
